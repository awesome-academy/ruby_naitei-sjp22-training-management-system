<% provide(:title, @user_supervisor.name) %>

<div class="supervisor-manager-page">
  <!-- Page Header with Title and Actions -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="page-title mb-0"><%= @user_supervisor.name %></h1>
    <div class="dropdown">
      <button class="btn btn-primary dropdown-toggle action-btn" type="button" id="supervisorActions" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <i class="fas fa-cog mr-2"></i><%= t(".actions") %>
      </button>
      <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="supervisorActions">
        <li>
          <%= link_to "#", class: "dropdown-item", data: {toggle: "modal", target: "#editProfileModal"} do %>
            <i class="fas fa-edit mr-2"></i><%= t(".edit_profile") %>
          <% end %>
        </li>
        <li>
          <% if @user_supervisor.activated? %>
            <%= link_to update_status_admin_user_path(@user_supervisor, activated: false), class: "dropdown-item", data: {turbo_method: :patch} do %>
              <i class="fas fa-ban mr-2"></i><%= t(".deactivate_account") %>
            <% end %>
          <% else %>
            <%= link_to update_status_admin_user_path(@user_supervisor, activated: true), class: "dropdown-item", data: {turbo_method: :patch} do %>
              <i class="fas fa-check mr-2"></i><%= t(".activate_account") %>
            <% end %>
          <% end %>
        </li>
      </ul>
    </div>
  </div>

  <!-- supervisor Personal Information Card -->
  <div class="supervisor-info-card mb-4">
    <div class="card">
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <div class="info-item">
              <strong><%= t(".email") %>:</strong> <%= @user_supervisor.email %>
            </div>
            <div class="info-item">
              <strong><%= t(".name") %>:</strong> <%= @user_supervisor.name %>
            </div>
          </div>
          <div class="col-md-6">
            <div class="info-item">
              <strong><%= t(".date_of_birth") %>:</strong> 
              <%= @user_supervisor.birthday ? @user_supervisor.birthday.strftime(Settings.formats.date) : Settings.nil_value %>
            </div>
            <div class="info-item">
              <strong><%= t(".gender") %>:</strong> 
              <%= @user_supervisor.gender ? t("enums.user.gender.#{@user_supervisor.gender}") : Settings.nil_value %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Filter Section -->
  <div class="filter-section mb-4">
    <div class="filter-header">
      <h5 class="filter-title"><%= t(".course_history") %></h5>
    </div>

   <%= render "admin/users/filter_user_details_form", user_supervisor: @user_supervisor %>
  </div>

  <!-- Course History Table -->
  <div class="table-card">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead>
          <tr>
            <th scope="col"><%= t(".table.id") %></th>
            <th scope="col"><%= t(".table.courses") %></th>
            <th scope="col"><%= t(".table.start_date") %></th>
            <th scope="col"><%= t(".table.end_date") %></th>
            <th scope="col"><%= t(".table.trainees") %></th>
            <th scope="col"><%= t(".table.status") %></th>
            <th scope="col" class="actions-col"><%= t(".table.actions") %></th>
          </tr>
        </thead>
        <tbody>
          <% if @supervisor_courses.any? %>
            <% @supervisor_courses.each_with_index do |course, index| %>
              <%= render "admin/users/user_courses_list", course: course, user_supervisor: @user_supervisor, index: index %>
            <% end %>
          <% else %>
            <tr>
              <td colspan="6" class="text-center empty-state">
                <i class="fas fa-graduation-cap fa-3x mb-3"></i>
                <p class="text-muted mb-0"><%= t(".no_courses") %></p>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Pagination -->
  <div class="d-flex justify-content-between align-items-center mt-4">
    <div class="pagination-info text-muted">
      <%= t(".showing_courses", count: @supervisor_courses.count) %>
    </div>
    <div class="pagination-container">
       <%== pagy_bootstrap_nav(@pagy) if @pagy.pages > Settings.pagination.min_pages_to_show %>
    </div>
  </div>
</div>

<!-- Edit Profile Modal -->
<%= render "admin/users/modal_edit_profile" %>
