<div class="subject-edit-card" data-subject-id="<%= course_subject.id %>">
  <div class="subject-edit-header">
    <div class="subject-position">
      <label class="position-label">[<%= index + 1 %>]</label>
      <input type="hidden" name="course[course_subjects_attributes][<%= index %>][id]" value="<%= course_subject.id %>">
      <input type="hidden" name="course[course_subjects_attributes][<%= index %>][position]" value="<%= course_subject.position || index + 1 %>" class="position-input">
    </div>
    
    <div class="subject-status-indicator">
      <span class="status-badge status-<%= subject_status(course_subject) %>">
        <%= t("courses.subjects.subject_status.#{subject_status(course_subject)}") %>
      </span>
    </div>
    
    <div class="subject-drag-handle">
      <i class="fas fa-grip-vertical"></i>
    </div>
  </div>

  <div class="subject-edit-content">
    <div class="subject-basic-info">
      <div class="subject-dates">
        <label class="form-label me-2"><%= t("start_date") %>:</label>
        <input type="date"
               name="course[course_subjects_attributes][<%= index %>][start_date]"
               value="<%= format_date_for_input(course_subject.start_date) %>"
               data-duration-days="<%= course_subject.subject.estimated_time_days %>"
               data-finish-input="course_course_subjects_attributes_<%= index %>_finish_date"
               class="form-control form-control-sm d-inline-block subject-start-date w-auto">
        <input type="hidden"
               name="course[course_subjects_attributes][<%= index %>][finish_date]"
               value="<%= format_date_for_input(course_subject.finish_date) %>"
               id="course_course_subjects_attributes_<%= index %>_finish_date">
        <span class="mx-2">→</span>
        <span class="finish-date-display"><%= course_subject.finish_date&.strftime(Settings.formats.date) %></span>
      </div>
      <div class="subject-name">
        <strong><%= course_subject.subject.name %></strong>: 
        <%= t("courses.subjects.time_to_finish", days: course_subject.subject.estimated_time_days) %>
      </div>
    </div>

    <div class="subject-actions-edit">
      <button type="button" class="btn btn-outline-primary btn-sm" disabled>
        <%= t("courses.edit.edit_subject_content") %>
      </button>
    </div>
  </div>

  <div class="tasks-edit-section">
    <div class="tasks-preview-header">
      <h6><%= t("courses.subjects.tasks_preview") %></h6>
      <button type="button" class="btn btn-outline-success btn-sm toggle-task-form" data-subject-id="<%= course_subject.id %>">
        <%= t("courses.edit.fill_more_tasks") %>
      </button>
    </div>

    <div class="existing-tasks">
      <% course_subject.tasks.each do |task| %>
        <div class="task-item">
          <span class="task-bullet">•</span>
          <span class="task-name"><%= task.name %></span>
        </div>
      <% end %>
      <% if course_subject.tasks.empty? %>
        <div class="no-tasks">
          <em><%= t("courses.subjects.no_tasks") %></em>
        </div>
      <% end %>
    </div>

    <div class="new-tasks-form d-none" id="tasks-form-<%= course_subject.id %>">
      <div class="new-tasks-container">
        <div class="new-task-template d-none">
          <div class="new-task-item">
            <div class="form-row">
              <div class="col-md-11">
                <input type="text"
                       name="course[course_subjects_attributes][<%= index %>][tasks_attributes][NEW_TASK_INDEX][name]"
                       placeholder="<%= t('courses.edit.add_task_placeholder') %>"
                       class="form-control form-control-sm" disabled="disabled">
              </div>
              <div class="col-md-1">
                <button type="button" class="btn btn-outline-danger btn-sm remove-task">
                  <%= t("courses.edit.remove_task") %>
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <div class="new-tasks-list"></div>
        
        <div class="add-task-controls">
          <button type="button" class="btn btn-outline-primary btn-sm add-new-task" data-subject-id="<%= course_subject.id %>">
            <i class="fas fa-plus"></i> <%= t("courses.edit.add_task_button") %>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
